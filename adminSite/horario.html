<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="assets/img/nur.png">
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
    <title>Horario</title>
    <style>
        .titulosTablas {
            font-size: 16px;
            margin-left: 0.4%;
            font-weight: bold;
        }
        
        @media print {
            .no-print,
            .no-print * {
                display: none !important;
            }
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <table style="width:85%;margin: auto;margin-top: 10px;font-size: 12px">
            <tr>
                <td id='nombreCodigo'></td>
                <td id='idsemestreActual'></td>
                <td id='semestreActual'></td>
            </tr>
            <tr>
                <td id='carrera'></td>
                <td id='semestreIngreso'></td>
                <td id='tipoColegio'></td>
            </tr>
            <tr>
                <td id='Pensul'></td>
                <td id='codigoCentro'></td>
                <td id='creditosVencidos'></td>
            </tr>
        </table>
        <a class='no-print' id='imprimir' href="#" style="font-size: 50px;float: left;color: black;text-decoration: none;margin-left: 0.4%;">
            <i class="pe-7s-print"></i>
        </a>
        <br>
        <h4 style="font-weight: bold;padding-top: 15px;" class="text-center">Horario</h4>
        <div id='materiasPresencial'>
            <table id="tablaHorario" class="table">
                <thead>
                    <tr>
                        <th scope="col">MATERIA</th>
                        <th scope="col">TIPO</th>
                        <th scope="col">DOCENTE</th>
                        <th scope="col">GRUPO</th>
                        <th scope="col">HORARIO</th>
                        <th scope="col">DIAS</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>


</body>
<script src="assets/js/jquery.3.2.1.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(document).ready(function() {
        cargarPagina();

    })
    $("#imprimir").click(function() {
        window.print();
    });

    function cargarPagina() {
        obtenerHorarios();
        InfoPersonal();
        InfoCarrera();
    }

    function InfoCarrera() {
        var token = sessionStorage.getItem("token");
        jQuery.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            'type': 'POST',
            'url': "http://sisnur.nur.edu:8085/api/Registros/GetAlumnoCarreras",
            'dataType': 'json',
            'success': cargarInfoCarrera
        });
    }

    function pad(number, length) {

        var str = '' + number;
        while (str.length < length) {
            str = '0' + str;
        }

        return str;

    }

    function cargarInfoCarrera(resultado) {

        resultado.Data.forEach(function(element) {
            const {
                LCARRERA_ID,
                SCARRERA_DSC,
                LCODPENSUM,
                LPERIODOACTUAL,
                LPERIODOINICIO,
                SCODCENTRO,
                LCREDVENCIDOS,
                LPERIODOACTUAL_ID
            } = element;
            var carrera = pad(LCARRERA_ID, 4) + '    ' + SCARRERA_DSC;
            var pensul = 'Cod. Pensum: ' + LCODPENSUM
            var semestreActual = 'Semestre Act.:  ' + LPERIODOACTUAL_ID
            var semestreIngreso = 'Sem. Ingreso:    ' + LPERIODOINICIO
            var codigoCentro = 'Cod. Centro:    ' + SCODCENTRO
            var fechaPeriodo = LPERIODOACTUAL
            var creditosVencidos = 'Cred. Vencidos:     ' + LCREDVENCIDOS
            $('#carrera').text(carrera)
            $('#Pensul').text(pensul)
            $('#idsemestreActual').text(semestreActual)
            $('#semestreIngreso').text(semestreIngreso)
            $('#codigoCentro').text(codigoCentro)
            $('#creditosVencidos').text(creditosVencidos)
            $('#semestreActual').text(semestreActual)
        });
    }

    function InfoPersonal() {
        var token = sessionStorage.getItem("token");
        jQuery.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            'type': 'POST',
            'url': "http://sisnur.nur.edu:8085/api/Registros/GetAlumnoInfo",
            'dataType': 'json',
            'success': cargarInformacionPersonal
        });
    }

    function cargarInformacionPersonal(resultado) {

        const {
            SREGISTRO,
            SAPELLIDOP,
            SAPELLIDOM,
            SNOMBRES,
            DTFECHNAC,
            SSEXO_DSC,
            SCELULAR,
            STELEFONO,
            SEMAIL,
            SESTADOCIVIL_DSC,
            STIPOSANGRE_DSC,
            BOOLACTIVOPASIVO,
            LHORASERVICIO,
            STIPOCOLEGIO
        } = resultado.Data;
        var NombreCompleto = SREGISTRO + '    ' + SNOMBRES + ' ' + SAPELLIDOP + ' ' + SAPELLIDOM;
        $('#nombreCodigo').text(NombreCompleto);
        var colegio = 'Colegio:	' + STIPOCOLEGIO
        $('#tipoColegio').text(colegio)
    }



    function obtenerHorarios() {

        var carreraId = sessionStorage.getItem("carreraId");
        var periodoActual = sessionStorage.getItem("periodoActual");
        var token = sessionStorage.getItem("token");
        var usuario = new Object();
        usuario.pCarreraId = carreraId;
        usuario.pPeriodoId = periodoActual;
        jQuery.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            'type': 'POST',
            'data': JSON.stringify(usuario),
            'url': "http://sisnur.nur.edu:8085/api/Registros/GetNotasFaltas",
            'dataType': 'json',
            'success': cargarHorarios
        });
    }

    function cargarHorarios(resultado) {
        resultado.Data.forEach(function(element) {
            const {
                SCENTRO_DSC,
                SCODMATERIA,
                SMATERIA_DSC,
                SCODGRUPO,
                DOCENTE,
                HORARIO
            } = element;
            var tr = $("<tr ></tr>")
            tr.append($("<td></td>").text(SMATERIA_DSC))
            tr.append($("<td></td>").text(SCENTRO_DSC))
            tr.append($("<td></td>").text(DOCENTE))
            tr.append($("<td></td>").text(SCODGRUPO))
            tr.append($("<td></td>").text(HORARIO == null ? "" : HORARIO[0].ENTRADA + " - " + HORARIO[0].SALIDA))
            tr.append($("<td></td>").text(HORARIO == null ? "" : getDiasHorario(HORARIO)))
            $('#tablaHorario').append(tr);
        });
    }

    function getDiasHorario(HORARIO) {
        var dias = ''
        HORARIO.forEach(function(element) {
            dias += element.SDIA_DSC.substring(0, 2).toUpperCase() + "  ";
        })
        return dias;
    }
</script>

</html>